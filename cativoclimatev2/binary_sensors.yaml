binary_sensor:

######------------Push bottons-------------#####
  - platform: gpio
    pin:
      number: GPIO0
      mode: INPUT_PULLUP
      inverted: True
    name: "Config Button"
    on_click:
    - min_length: 20ms
      max_length: 400ms
      then:
        # Single press action: move to next page
        - display.page.show_next: ${name}_display
        - component.update: ${name}_display
    - min_length: 500ms
      max_length: 2000ms
      then:
        # Long press action: change select option
        - select.next: climate_mode
        - component.update: ${name}_display
    internal: True

######------------Sensors presence-------------#####
  - platform: ble_presence
    mac_address: A4:C1:38:80:89:FB
    name: "${division_1} Sensor Presence"
    device_class: connectivity
    icon: mdi:bluetooth-connect
    web_server:
      sorting_group_id: sort_group_status
  - platform: ble_presence
    mac_address: A4:C1:38:21:29:43
    name: "${division_2} Sensor Presence"
    device_class: connectivity
    icon: mdi:bluetooth-connect
    web_server:
      sorting_group_id: sort_group_status
  - platform: ble_presence
    mac_address: A4:C1:38:9D:AF:D3
    name: "${division_3} Sensor Presence"
    device_class: connectivity
    icon: mdi:bluetooth-connect
    web_server:
      sorting_group_id: sort_group_status
  - platform: ble_presence
    mac_address: A4:C1:38:CC:03:7F
    name: "${division_4} Sensor Presence"
    device_class: connectivity
    icon: mdi:bluetooth-connect
    web_server:
      sorting_group_id: sort_group_status

  - platform: gpio
    pin:
      pcf8574: inputs
      number: 0
      mode:
        input: true
      inverted: true  #Not sure!
    name: "Mixer Error"
    id: ${name}_mixer_error
    device_class: problem
    on_press:
      then:
        - logger.log:
            level: ERROR
            tag: "ALARM"
            format: "Water mixer error signal received!"
        - homeassistant.event:  # Sends a custom event to Home Assistant
            event: esphome.critical_alarm
            data:
              message: "Water mixer error signal received!"
              entity_id: binary_sensor.alarm_sensor
    icon: mdi:alert
    web_server:
      sorting_group_id: sort_group_status
      sorting_weight: 5

  - platform: gpio
    pin:
      pcf8574: inputs
      number: 5
      mode:
        input: true
      inverted: true
    name: "Water circulator is ON"
    id: ${name}_water_circulator_on
    on_press:
      then:
        - climate.control:
            id: ${name}_mixer_controller
            mode: HEAT
    on_release:
      then:
        - climate.control:
            id: ${name}_mixer_controller
            mode: "OFF"
    device_class: running
    icon: mdi:pump
    web_server:
      sorting_group_id: sort_group_water_circuit
      sorting_weight: 11

    #------------------------------ Control if at least one of the thermostats is ON to keep heatpump ON ----------
  - platform: template
    name: "Valves're ON"
    id: ${name}_any_valve_on
    condition:
      or:
        - switch.is_on: "${name}_${division_id_1}_valve"
        - switch.is_on: "${name}_${division_id_2}_valve"
        - switch.is_on: "${name}_${division_id_3}_valve"
        - switch.is_on: "${name}_${division_id_4}_valve"
    on_press:
      - script.execute: start_heat_pump
    on_release:
      - script.execute: stop_heat_pump
    device_class: running
    icon: mdi:pipe-valve
    web_server:
      sorting_group_id: sort_group_water_circuit
      sorting_weight: 10
      
#  - platform: homeassistant
#    name: "Global switch state"
#    entity_id: "{heatpump_power_id}"

###------ HeatPump Status Sensors
  - platform: template
    name: "Heat pump reachable"
    id: ${name}_heat_pump_reachable
    device_class: connectivity
    on_release:
      then:
        - logger.log:
            level: ERROR
            tag: "ALARM"
            format: "Heat Pump Power Switch is not reachable!"
        - homeassistant.event:  # Sends a custom event to Home Assistant
            event: esphome.critical_alarm
            data:
              message: "Heat Pump Power Switch is not reachable!"
              entity_id: binary_sensor.alarm_sensor
    icon: mdi:wifi
    web_server:
      sorting_group_id: sort_group_status
      sorting_weight: 6
  - platform: template
    id: ${name}_heat_pump_is_running
    name: "Heat Pump Running"
    device_class: running
    icon: mdi:heat-pump-outline
  - platform: template
    id: ${name}_heat_pump_has_power
    name: "Heat Pump has power"
    device_class: plug
    internal: True
    icon: mdi:power-plug-outline